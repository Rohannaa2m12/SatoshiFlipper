<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Satoshi Flipper ‚Äî Bitcoin Flip Inu</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
  <style>
    :root {
      --bg: #0d0c0f;
      --surface: #16141a;
      --panel: #1c1a21;
      --border: #2d2a35;
      --text: #f0ecf4;
      --muted: #847a8f;
      --gold: #f5b042;
      --gold-dim: #c9922e;
      --green: #4ade80;
      --red: #f87171;
      --accent: #a78bfa;
      --radius: 12px;
      --font-sans: "Space Grotesk", system-ui, sans-serif;
      --font-mono: "JetBrains Mono", monospace;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--font-sans);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
      background-image:
        radial-gradient(ellipse 100% 50% at 50% -15%, rgba(167, 139, 250, 0.12), transparent 55%),
        radial-gradient(ellipse 60% 40% at 85% 70%, rgba(245, 176, 66, 0.06), transparent 45%);
    }
    .app {
      max-width: 560px;
      margin: 0 auto;
      padding: 1.5rem;
      min-height: 100vh;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      padding: 1rem 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 1.5rem;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }
    .logo-emoji { font-size: 1.8rem; }
    .logo-text {
      font-weight: 700;
      font-size: 1.4rem;
      background: linear-gradient(135deg, var(--gold), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .tagline { font-size: 0.75rem; color: var(--muted); margin-top: 0.15rem; }
    .wallet-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    .addr {
      font-family: var(--font-mono);
      font-size: 0.8rem;
      color: var(--muted);
      max-width: 140px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .btn {
      font-family: var(--font-sans);
      font-size: 0.85rem;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s, box-shadow 0.2s;
    }
    .btn:hover { background: var(--surface); border-color: var(--accent); }
    .btn-primary {
      background: linear-gradient(135deg, #5b21b6, #7c3aed);
      border-color: var(--accent);
      color: #fff;
    }
    .btn-primary:hover { box-shadow: 0 0 20px rgba(167, 139, 250, 0.35); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }

    .card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-bottom: 1.25rem;
    }
    .card h2 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--gold);
    }

    .stats-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
      margin-bottom: 1.25rem;
    }
    .stat {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 0.75rem;
    }
    .stat .label { font-size: 0.7rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; }
    .stat .value { font-family: var(--font-mono); font-size: 1rem; color: var(--text); margin-top: 0.25rem; }

    .flip-area {
      text-align: center;
      padding: 1rem 0;
    }
    .choice-btns {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-bottom: 1.25rem;
      flex-wrap: wrap;
    }
    .choice-btn {
      flex: 1;
      min-width: 120px;
      padding: 1rem 1.25rem;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: var(--radius);
      border: 2px solid var(--border);
      background: var(--surface);
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
    }
    .choice-btn:hover { border-color: var(--gold-dim); background: rgba(245, 176, 66, 0.08); }
    .choice-btn.active { border-color: var(--gold); background: rgba(245, 176, 66, 0.15); color: var(--gold); }
    .choice-btn .emoji { display: block; font-size: 1.8rem; margin-bottom: 0.35rem; }

    .bet-row {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .bet-row input {
      font-family: var(--font-mono);
      font-size: 1rem;
      width: 140px;
      padding: 0.65rem 0.85rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--surface);
      color: var(--text);
    }
    .bet-row input:focus {
      outline: none;
      border-color: var(--accent);
    }
    .bet-row span { color: var(--muted); font-size: 0.9rem; }

    .flip-go {
      width: 100%;
      padding: 0.9rem;
      font-size: 1.05rem;
      margin-top: 0.5rem;
    }

    .result-box {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      font-family: var(--font-mono);
      font-size: 0.9rem;
      display: none;
    }
    .result-box.visible { display: block; }
    .result-box.win { background: rgba(74, 222, 128, 0.12); border: 1px solid var(--green); color: #86efac; }
    .result-box.loss { background: rgba(248, 113, 113, 0.12); border: 1px solid var(--red); color: #fca5a5; }
    .result-box.pending { background: rgba(245, 176, 66, 0.1); border: 1px solid var(--gold-dim); color: var(--gold); }

    .history-title { font-size: 0.85rem; color: var(--muted); margin-bottom: 0.5rem; }
    .history-list {
      max-height: 200px;
      overflow-y: auto;
    }
    .history-item {
      font-size: 0.8rem;
      padding: 0.4rem 0;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .history-item:last-child { border-bottom: none; }
    .history-item .won { color: var(--green); }
    .history-item .lost { color: var(--red); }

    .msg {
      font-size: 0.85rem;
      padding: 0.75rem;
      border-radius: 8px;
      margin-top: 0.75rem;
    }
    .msg.info { background: rgba(167, 139, 250, 0.12); border: 1px solid var(--accent); }
    .msg.err { background: rgba(248, 113, 113, 0.12); border: 1px solid var(--red); }
    .msg.ok { background: rgba(74, 222, 128, 0.12); border: 1px solid var(--green); }

    .contract-row {
      margin-top: 1rem;
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }
    .contract-row input {
      flex: 1;
      min-width: 200px;
      font-family: var(--font-mono);
      font-size: 0.8rem;
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--surface);
      color: var(--text);
    }

    footer {
      padding: 1.5rem 0;
      border-top: 1px solid var(--border);
      font-size: 0.75rem;
      color: var(--muted);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <div class="logo">
          <span class="logo-emoji">ü™ô</span>
          <span class="logo-text">Satoshi Flipper</span>
        </div>
        <p class="tagline">Bitcoin Flip Inu ‚Äî Double your sats or lose them</p>
      </div>
      <div class="wallet-row">
        <span class="addr" id="wallet-addr">‚Äî</span>
        <button type="button" class="btn" id="btn-connect">Connect wallet</button>
      </div>
    </header>

    <div class="contract-row">
      <input type="text" id="contract-address" placeholder="BitcoinFlipInu contract 0x‚Ä¶" />
      <button type="button" class="btn" id="btn-set-contract">Use</button>
    </div>

    <div class="stats-row">
      <div class="stat">
        <div class="label">Total wagered</div>
        <div class="value" id="stat-wagered">‚Äî</div>
      </div>
      <div class="stat">
        <div class="label">Total payouts</div>
        <div class="value" id="stat-payouts">‚Äî</div>
      </div>
      <div class="stat">
        <div class="label">Flips</div>
        <div class="value" id="stat-flips">‚Äî</div>
      </div>
      <div class="stat">
        <div class="label">House edge</div>
        <div class="value">2.5%</div>
      </div>
    </div>

    <div class="card">
      <h2>Flip the coin</h2>
      <div class="flip-area">
        <p style="color: var(--muted); font-size: 0.9rem; margin-bottom: 1rem;">Pick heads or tails, set wager (0.01‚Äì10 ETH), then flip.</p>
        <div class="choice-btns">
          <button type="button" class="choice-btn" id="choice-heads" data-choice="true">
            <span class="emoji">ü™ô</span> HEADS
          </button>
          <button type="button" class="choice-btn" id="choice-tails" data-choice="false">
            <span class="emoji">üêï</span> TAILS
          </button>
        </div>
        <div class="bet-row">
          <input type="text" id="bet-eth" value="0.1" placeholder="0.1" />
          <span>ETH</span>
        </div>
        <button type="button" class="btn btn-primary flip-go" id="btn-flip">Flip (sends ETH)</button>
        <div class="result-box" id="result-box"></div>
        <div id="flip-msg"></div>
      </div>
    </div>

    <div class="card">
      <h2>Last results</h2>
      <div class="history-title">Recent flips (this session)</div>
      <div class="history-list" id="history-list"></div>
    </div>

    <footer>
      Satoshi Flipper ¬∑ Bitcoin Flip Inu ¬∑ EVM mainnet ¬∑ For entertainment only
    </footer>
  </div>

  <script>
    (function () {
      const ABI = [
        "function flip(bool choiceHeads) payable",
        "function totalWagered() view returns (uint256)",
        "function totalPayouts() view returns (uint256)",
        "function flipNonce() view returns (uint256)",
        "function bfiPaused() view returns (bool)",
        "event BFI_FlipResolved(uint256 indexed flipId, address indexed player, bool choiceHeads, bool outcomeHeads, bool won, uint256 payoutWei)"
      ];

      let provider = null;
      let signer = null;
      let contract = null;
      let contractAddress = "";
      const history = [];

      const walletEl = document.getElementById("wallet-addr");
      const btnConnect = document.getElementById("btn-connect");
      const contractInput = document.getElementById("contract-address");
      const btnSetContract = document.getElementById("btn-set-contract");
      const choiceHeads = document.getElementById("choice-heads");
      const choiceTails = document.getElementById("choice-tails");
      const betEth = document.getElementById("bet-eth");
      const btnFlip = document.getElementById("btn-flip");
      const resultBox = document.getElementById("result-box");
      const flipMsg = document.getElementById("flip-msg");
      const historyList = document.getElementById("history-list");
      const statWagered = document.getElementById("stat-wagered");
      const statPayouts = document.getElementById("stat-payouts");
      const statFlips = document.getElementById("stat-flips");

      function showMsg(el, text, type) {
        el.innerHTML = text ? `<div class="msg ${type}">${text}</div>` : "";
      }

      function setChoice(choice) {
        choiceHeads.classList.toggle("active", choice === true);
        choiceTails.classList.toggle("active", choice === false);
      }

      choiceHeads.addEventListener("click", () => setChoice(true));
      choiceTails.addEventListener("click", () => setChoice(false));

      btnSetContract.addEventListener("click", () => {
        const addr = (contractInput.value || "").trim();
        if (!addr || !addr.startsWith("0x")) {
          showMsg(flipMsg, "Enter a valid contract address (0x‚Ä¶).", "err");
          return;
        }
        contractAddress = addr;
        contract = new ethers.Contract(addr, ABI, signer || provider);
        showMsg(flipMsg, "Contract set. You can flip once connected.", "ok");
        refreshStats();
      });

      async function connect() {
        if (typeof window.ethereum === "undefined") {
          showMsg(flipMsg, "Install MetaMask or another Web3 wallet.", "err");
          return;
        }
        try {
          provider = new ethers.BrowserProvider(window.ethereum);
          const accounts = await provider.send("eth_requestAccounts", []);
          if (!accounts.length) return;
          signer = await provider.getSigner();
          const addr = await signer.getAddress();
          walletEl.textContent = addr.slice(0, 6) + "‚Ä¶" + addr.slice(-4);
          btnConnect.textContent = "Connected";
          btnConnect.disabled = true;
          if (contractAddress) {
            contract = new ethers.Contract(contractAddress, ABI, signer);
            refreshStats();
          }
        } catch (e) {
          showMsg(flipMsg, e.message || "Connection failed.", "err");
        }
      }

      btnConnect.addEventListener("click", connect);

      async function refreshStats() {
        if (!contract || !provider) return;
        try {
          const [wagered, payouts, nonce] = await Promise.all([
            contract.totalWagered(),
            contract.totalPayouts(),
            contract.flipNonce()
          ]);
          statWagered.textContent = ethers.formatEther(wagered) + " ETH";
          statPayouts.textContent = ethers.formatEther(payouts) + " ETH";
          statFlips.textContent = nonce.toString();
        } catch (_) {
          statWagered.textContent = "‚Äî";
          statPayouts.textContent = "‚Äî";
          statFlips.textContent = "‚Äî";
        }
      }

      btnFlip.addEventListener("click", async () => {
        if (!contract || !signer) {
          showMsg(flipMsg, "Connect wallet and set contract first.", "err");
          return;
        }
        const choice = choiceHeads.classList.contains("active");
        let eth;
        try {
          eth = ethers.parseEther(betEth.value.trim() || "0.1");
        } catch (_) {
          showMsg(flipMsg, "Invalid bet amount (e.g. 0.1).", "err");
          return;
        }
        const minWei = ethers.parseEther("0.01");
        const maxWei = ethers.parseEther("10");
        if (eth < minWei || eth > maxWei) {
          showMsg(flipMsg, "Bet must be between 0.01 and 10 ETH.", "err");
          return;
        }

        resultBox.className = "result-box visible pending";
        resultBox.textContent = "Confirm in wallet‚Ä¶";
        showMsg(flipMsg, "", "");
        btnFlip.disabled = true;

        try {
          const tx = await contract.flip(choice, { value: eth });
          resultBox.textContent = "Mining‚Ä¶ " + tx.hash.slice(0, 10) + "‚Ä¶";
          const receipt = await tx.wait();
          const parsed = receipt.logs.find(l => l.fragment && l.fragment.name === "BFI_FlipResolved");
          let won = false;
          let payoutWei = 0n;
          if (parsed && parsed.args) {
            won = parsed.args[4];
            payoutWei = parsed.args[5];
          }
          resultBox.className = "result-box visible " + (won ? "win" : "loss");
          resultBox.textContent = won
            ? "You won! Payout: " + ethers.formatEther(payoutWei) + " ETH"
            : "Tails (or heads) ‚Äî you lost this flip.";
          history.unshift({ choice, won, payout: payoutWei, tx: tx.hash });
          if (history.length > 20) history.pop();
          renderHistory();
          refreshStats();
        } catch (e) {
          resultBox.className = "result-box visible loss";
          resultBox.textContent = "Tx failed.";
          showMsg(flipMsg, e.message || "Transaction failed.", "err");
        }
        btnFlip.disabled = false;
      });

      function renderHistory() {
        historyList.innerHTML = history.map(h => {
          const side = h.choice ? "HEADS" : "TAILS";
          const cls = h.won ? "won" : "lost";
          const text = h.won ? "+" + ethers.formatEther(h.payout) + " ETH" : "Loss";
          return `<div class="history-item"><span>${side}</span><span class="${cls}">${text}</span></div>`;
        }).join("");
      }
    })();
  </script>
